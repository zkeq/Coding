---
title: ç¬”è®° | ä½¿ç”¨ Uptime Kuma ç›‘æ§ç½‘ç«™å¹¶æ¨é€å¾®ä¿¡
tags: [ç¬”è®° ]
description: æœ¬æ–‡ä¸»è¦è®°å½•å®ç°<br>ä½¿ç”¨ Uptime Kuma ç›‘æ§ç½‘ç«™å¹¶æ¨é€å¾®ä¿¡
date: 2022-04-24 00:30:31
categories: ç¬”è®° 
cover: https://ik.imagekit.io/zkeq/2022-04-24/9.png
sticky: 3
---

## å‰è¨€

æåˆ°ç›‘æ§ï¼Œå¤§å®¶æƒ³åˆ°çš„å¤§æ¦‚æ˜¯ [UptimeRobot](https://uptimerobot.com/) ï¼Œä¸ªäººå…è´¹ 50 ä¸ªç«™ç‚¹ï¼Œè€Œä¸”ç›‘æ§é¡µé¢ä¹Ÿå¾ˆç‚«é…·

ä½†æ˜¯æœ‰ä¸ªç¼ºç‚¹å°±æ˜¯ä¼¼ä¹å®šåˆ¶åŸŸåçš„åŠŸèƒ½è¦ä»˜è´¹ï¼Ÿ

è¯•è¿‡æŠŠç«™ç‚¹æ‰’ä¸‹æ¥ï¼Œä½†æ˜¯å¥½åƒæœ‰ `CORS` çš„è·¨åŸŸé—®é¢˜ï¼ˆï¼ˆï¼ˆï¼ˆ

æœ€è¿‘å‡ å¤©ï¼Œæœ‹å‹é‚£é‡Œå‘ç°äº†ä¸€æ¬¾æ›¿ä»£å“ï¼Œè¿™é¡µé¢æ„Ÿè§‰æ¯” [UptimeRobot](https://uptimerobot.com/) è¿˜ç‚«é…· *

- https://github.com/louislam/uptime-kuma

æˆå“ï¼š[Zkeq ã® ç›‘æ§äº‘å° (icodeq.com)](https://uptime.icodeq.com)

è§å›¾ ğŸ‘€

![1](https://ik.imagekit.io/zkeq/2022-04-24/1.png)

### åå°ä¹Ÿååˆ†å¥½çœ‹ ~

![2](https://ik.imagekit.io/zkeq/2022-04-24/2.png)

### è¯¦æƒ…é¡µé¢

![3](https://ik.imagekit.io/zkeq/2022-04-24/3.png)

### å¹¶ä¸”è¿˜å®ç°äº†å¾®ä¿¡æ¨é€çš„åŠŸèƒ½

![4](https://ik.imagekit.io/zkeq/2022-04-24/4.jpg)

## å®ç°æ­¥éª¤

### æ­å»ºéƒ¨åˆ†

é¡¹ç›®åœ°å€

- https://github.com/louislam/uptime-kuma


>
> `Replit` æ¨èéƒ¨ç½²ä»“åº“ï¼šhttps://github.com/valetzx/uptimekumaonreplit
> 


ç›´æ¥è·Ÿæ•™ç¨‹æ­å»ºå³å¯ï¼Œé‡ç‚¹è®²ä¸€ä¸‹æ€ä¹ˆæŠŠæ¨é€å‘åˆ° ã€æ­£å¸¸å¾®ä¿¡ã€‘ã€‚

å†…ç½®ä¸€ä¸ªä¼ä¸šå¾®ä¿¡é€šé“ï¼Œä½†æ˜¯æ­£å¸¸äººè°ç”¨é‚£ç©æ„å•Šï¼‰ï¼‰ï¼‰ï¼‰

è¿™é‡Œç”¨åˆ°çš„ä¸€ä¸ªé¡¹ç›®æ˜¯æ–¹ç³–çš„å¼€æºç‰ˆï¼ˆå› ä¸ºæˆ‘ç©·ï¼Œå­¦ç”Ÿå˜›ï¼Œç†è§£ä¸€ä¸‹ï¼‰ï¼‰

- https://github.com/easychen/wecomchan

  easychen/wecomchan: é€šè¿‡ä¼ä¸šå¾®ä¿¡å‘å¾®ä¿¡æ¨é€æ¶ˆæ¯çš„é…ç½®æ–‡æ¡£ã€ç›´æ¨å‡½æ•°å’Œå¯è‡ªè¡Œæ­å»ºçš„åœ¨çº¿æœåŠ¡ä»£ç ã€‚å¯ä»¥çœ‹æˆServeré…±çš„å¼€æºæ›¿ä»£æ–¹æ¡ˆä¹‹ä¸€ã€‚

å…¶å®è¿™ä¸ªé¡¹ç›®é‡Œé¢çš„ `README.md` å†™çš„å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œç”šè‡³è¿ç”¨æ³•éƒ½æœ‰......

```python
PYTHONç‰ˆ:

def send_to_wecom(text,wecom_cid,wecom_aid,wecom_secret,wecom_touid='@all'):
        return response
    else:
        return False

def send_to_wecom_image(base64_content,wecom_cid,wecom_aid,wecom_secret,wecom_touid='@all'):
        return response
    else:
        return False

def send_to_wecom_markdown(text,wecom_cid,wecom_aid,wecom_secret,wecom_touid='@all'):
        return response
    else:
        return False
    
ä½¿ç”¨å®ä¾‹ï¼š

ret = send_to_wecom("æ¨é€æµ‹è¯•\r\næµ‹è¯•æ¢è¡Œ", "ä¼ä¸šIDâ‘¢", "åº”ç”¨IDâ‘ ", "åº”ç”¨secretâ‘¡");
print(ret)
ret = send_to_wecom('<a href="https://www.github.com/">æ–‡æœ¬ä¸­æ”¯æŒè¶…é“¾æ¥</a>', "ä¼ä¸šIDâ‘¢", "åº”ç”¨IDâ‘ ", "åº”ç”¨secretâ‘¡");
print(ret)
ret = send_to_wecom_image("æ­¤å¤„å¡«å†™å›¾ç‰‡Base64", "ä¼ä¸šIDâ‘¢", "åº”ç”¨IDâ‘ ", "åº”ç”¨secretâ‘¡");
print(ret)
ret = send_to_wecom_markdown("**Markdown å†…å®¹**", "ä¼ä¸šIDâ‘¢", "åº”ç”¨IDâ‘ ", "åº”ç”¨secretâ‘¡");
print(ret)
```

é‚£ä¹ˆæ„Ÿè§‰ä¹Ÿæ²¡å•¥è®²çš„ï¼Œç›´æ¥è®²æ€ä¹ˆæ­å»ºå®ç°å§ã€‚

### é¦–å…ˆå»æŒ‰æ•™ç¨‹

- https://github.com/easychen/wecomchan#ä¼ä¸šå¾®ä¿¡åº”ç”¨æ¶ˆæ¯é…ç½®è¯´æ˜

é…ç½®å¥½è‡ªå·±çš„ä¼ä¸šå¾®ä¿¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ‹¿åˆ°è¿™ä¹ˆå‡ ä¸ªå­—æ®µ

```python
wecom_cid = "wwXXXXXXXXXXXXXXX"
wecom_aid = "1000XXX"
wecom_secret = "XXXXXXXXXXXX-XXXXXXXXXXX-XXXXXXXXXXXXXXXX"
```

å°±è¿™ä¸‰ä¸ªå­—æ®µå°±å¤Ÿäº†

### ç„¶åå»å†™ä¸€ä¸‹ FastAPI çš„é…ç½®

- è¿™ä¸ªç»è¿‡æˆ‘åŠ å·¥äº†ä¸€ä¸‹....æ”¯æŒäº† redis ç¼“å­˜ï¼Œéœ€è¦ `Redis` ç¯å¢ƒ

- `loguru` è®°å½•æ—¥å¿—

- `subprocess` ç”¨äºå¯åŠ¨ `Redis`

- `FastAPI` ä¸»è¦æ¡†æ¶

- `uvicorn` Fast API å¯åŠ¨å™¨

- ï¼‰ä¸è¿‡ï¼Œæˆ‘æ¨èä½¿ç”¨ `Replit` ç›´æ¥éƒ¨ç½²ï¼ŒæŠŠä»¥ä¸‹æ–‡ä»¶ç›´æ¥å¤åˆ¶ç²˜è´´è¿›å»ï¼Œç‚¹ `RUN` å°±è¡Œäº†ï¼ˆï¼‰ï¼ˆä¸è¡Œçš„è¯æ¥è¯„è®ºåŒº

   

`.\main.py`

```python
import base64
import json
import requests
import uvicorn
import redis
import logger as lg
from fastapi import FastAPI, Form
import subprocess
start_redis = "redis-server redis.conf"

r = redis.Redis(host='localhost', port=6379, db=0)


# å¦‚æœä½ ç”¨çš„ä¸ªäººç‰ˆï¼Œè¯·å°†ä»¥ä¸‹å¡«å…¥ç¯å¢ƒå˜é‡ä¸­
# å¹¶å–æ¶ˆæ³¨é‡Šä»¥ä¸‹ä»£ç 
# import os
# my_secret = os.environ['wecom_cid']
# wecom_aid = os.environ['wecom_aid']
# wecom_secret = os.environ['wecom_secret']

wecom_cid = "wwXXXXXXXXXXXXXXX"
wecom_aid = "1000XXX"
wecom_secret = "XXXXXXXXXXXX-XXXXXXXXXXX-XXXXXXXXXXXXXXXX"
app = FastAPI()


def get_token():
    global wecom_cid, wecom_aid, wecom_secret
    access_token = r.get('token')
    if not access_token:
        lg.logger_info('Redis access_token is empty, get from wecom')
        get_token_url = f"https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid={wecom_cid}&corpsecret={wecom_secret}"
        lg.logger_info('get_token_url: ' + get_token_url)
        response = requests.get(get_token_url).content
        lg.logger_info('response: ' + str(response))
        access_token = json.loads(response).get('access_token')
        lg.logger_success('access_token: ' + str(access_token))
        r.set('token', access_token, ex=7000)
    else:
        access_token = access_token.decode('utf-8')
        lg.logger_success(f"ä»Redis ä¸­æ‹¿åˆ° access_token")
    return access_token


def send_to_wecom(text, wecom_touid='@all'):
    access_token = get_token()
    lg.logger_success("message: " + str(text))
    if access_token and len(access_token) > 0:
        send_msg_url = f'https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token={access_token}'
        data = {
            "touser": wecom_touid,
            "agentid": wecom_aid,
            "msgtype": "text",
            "text": {
                "content": text
            },
            "duplicate_check_interval": 600
        }
        response = requests.post(send_msg_url, data=json.dumps(data)).content
        lg.logger_info("response: " + str(response))
        return response
    else:
        return False


def send_to_wecom_image(base64_content, wecom_touid='@all'):
    access_token = get_token()
    lg.logger_info('access_token: ' + str(access_token))
    if access_token and len(access_token) > 0:
        upload_url = f'https://qyapi.weixin.qq.com/cgi-bin/media/upload?access_token={access_token}&type=image'
        upload_response = requests.post(upload_url, files={
            "picture": base64.b64decode(base64_content)
        }).json()
        if "media_id" in upload_response:
            media_id = upload_response['media_id']
        else:
            return False

        send_msg_url = f'https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token={access_token}'
        data = {
            "touser": wecom_touid,
            "agentid": wecom_aid,
            "msgtype": "image",
            "image": {
                "media_id": media_id
            },
            "duplicate_check_interval": 600
        }
        response = requests.post(send_msg_url, data=json.dumps(data)).content
        lg.logger_success("response: " + str(response))
        return response
    else:
        return False


def send_to_wecom_markdown(text, wecom_touid='@all'):
    access_token = get_token()
    if access_token and len(access_token) > 0:
        send_msg_url = f'https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token={access_token}'
        data = {
            "touser": wecom_touid,
            "agentid": wecom_aid,
            "msgtype": "markdown",
            "markdown": {
                "content": text
            },
            "duplicate_check_interval": 600
        }
        lg.logger_success("message: " + str(text))
        response = requests.post(send_msg_url, data=json.dumps(data)).content
        lg.logger_success("response: " + str(response))
        return response
    else:
        return False


@app.post("/")
def main(type: str = Form(...), title: str = Form(...), body: str = Form(...), wecom_touid: str = Form(...)):
    if type == 'note':
        lg.logger_info(f'æ”¶åˆ°ç¬”è®°æ¶ˆæ¯ï¼š{title}')
        data = send_to_wecom(title + '\n' + body, wecom_touid)
    elif type == 'image':
        lg.logger_info(f'æ”¶åˆ°å›¾ç‰‡æ¶ˆæ¯ï¼š{title}')
        data = send_to_wecom_image(body, wecom_touid)
    elif type == 'markdown':
        lg.logger_info(f'æ”¶åˆ°markdownæ¶ˆæ¯ï¼š{title}')
        data = send_to_wecom_markdown(title + '\n' + body, wecom_touid)
    else:
        data = send_to_wecom(title + '\n' + body, wecom_touid)
    return data

@app.get("/")
def get():
    return {"msg": "å¥½è€¶ï¼Œéƒ¨ç½²æˆåŠŸäº†ï¼ä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯è¯·ä¸è¦å°†æ­¤åœ°å€å‘Šè¯‰åˆ«äººï¼ˆï¼ˆé˜²æ­¢å¾®ä¿¡æ¶ˆæ¯è¢«åˆ·çˆ†"}

@app.head("/")
def head():
    return {"msg": "å¥½è€¶ï¼Œéƒ¨ç½²æˆåŠŸäº†ï¼ä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯è¯·ä¸è¦å°†æ­¤åœ°å€å‘Šè¯‰åˆ«äººï¼ˆï¼ˆé˜²æ­¢å¾®ä¿¡æ¶ˆæ¯è¢«åˆ·çˆ†"}


if __name__ == "__main__":
    print("start redis")
    subprocess.Popen(start_redis, shell=True)
    uvicorn.run("main:app", host="0.0.0.0", port=8080, log_level="info")

```

### æ—¥å¿—åŠŸèƒ½

`.\logger.py`

```python
# coding:utf-8
from loguru import logger

logger.add("./log/file_{time}.log", rotation="20 MB")


def logger_error(msg):
    logger.error(msg)


def logger_warning(msg):
    logger.warning(msg)


def logger_debug(msg):
    logger.debug(msg)


def logger_exception(msg):
    logger.exception(msg)


def logger_critical(msg):
    logger.critical(msg)


def logger_success(msg):
    logger.success(msg)


def logger_info(msg):
    logger.info(msg)


def logger_trace(msg):
    logger.trace(msg)

```

`.\redis.conf`

```bash
bind 127.0.0.1 -::1
protected-mode yes
port 6379
tcp-backlog 511
timeout 0
tcp-keepalive 300
daemonize no
pidfile /var/run/redis_6379.pid
loglevel notice
logfile ""
databases 16
always-show-logo no
set-proc-title yes
proc-title-template "{title} {listen-addr} {server-mode}"
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
rdb-del-sync-files no
dir ./
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-diskless-load disabled
repl-disable-tcp-nodelay no
replica-priority 100
acllog-max-len 128
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no
lazyfree-lazy-user-del no
lazyfree-lazy-user-flush no
oom-score-adj no
oom-score-adj-values 0 200 800
disable-thp yes
appendonly no
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes
lua-time-limit 5000
slowlog-log-slower-than 10000
slowlog-max-len 128
latency-monitor-threshold 0
notify-keyspace-events ""
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes
jemalloc-bg-thread yes
```

`.\replit.nix` ï¼ˆè‹¥ ä½¿ç”¨çš„ Replitï¼‰

```bash
{ pkgs }: {
  deps = [
    pkgs.python38Full
    pkgs.redis
  ];
  env = {
    PYTHON_LD_LIBRARY_PATH = pkgs.lib.makeLibraryPath [
      # Neded for pandas / numpy
      pkgs.stdenv.cc.cc.lib
      pkgs.zlib
      # Needed for pygame
      pkgs.glib
      # Needed for matplotlib
      pkgs.xorg.libX11
    ];
    PYTHONBIN = "${pkgs.python38Full}/bin/python3.8";
    LANG = "en_US.UTF-8";
  };
}
```

`.\.replit`

```bash
# The command that runs the program.
run = ["python3", "main.py"]
# The primary language of the repl. There can be others, though!
language = "python3"
# The main file, which will be shown by default in the editor.
entrypoint = "main.py"
# A list of globs that specify which files and directories should
# be hidden in the workspace.
hidden = ["venv", ".config", "**/__pycache__", "**/.mypy_cache", "**/*.pyc"]

# Specifies which nix channel to use when building the environment.
[nix]
channel = "stable-21_11"

# Per-language configuration: python3
[languages.python3]
# Treats all files that end with `.py` as Python.
pattern = "**/*.py"
# Tells the workspace editor to syntax-highlight these files as
# Python.
syntax = "python"

  # The command needed to start the Language Server Protocol. For
  # linting and formatting.
  [languages.python3.languageServer]
  start = ["pyls"]

# The command to start the interpreter.
[interpreter]
  [interpreter.command]
  args = [
    "stderred",
    "--",
    "prybar-python3",
    "-q",
    "--ps1",
    "\u0001\u001b[33m\u0002îº§\u0001\u001b[00m\u0002 ",
    "-i",
  ]
  env = { LD_LIBRARY_PATH = "$PYTHON_LD_LIBRARY_PATH" }

# The environment variables needed to correctly start Python and use the
# package proxy.
[env]
VIRTUAL_ENV = "/home/runner/${REPL_SLUG}/venv"
PATH = "${VIRTUAL_ENV}/bin"
PYTHONPATH="${VIRTUAL_ENV}/lib/python3.8/site-packages"
REPLIT_POETRY_PYPI_REPOSITORY="https://package-proxy.replit.com/pypi/"
MPLBACKEND="TkAgg"

# Enable unit tests. This is only supported for a few languages.
[unitTest]
language = "python3"

# Add a debugger!
[debugger]
support = true

  # How to start the debugger.
  [debugger.interactive]
  transport = "localhost:0"
  startCommand = ["dap-python", "main.py"]

    # How to communicate with the debugger.
    [debugger.interactive.integratedAdapter]
    dapTcpAddress = "localhost:0"

    # How to tell the debugger to start a debugging session.
    [debugger.interactive.initializeMessage]
    command = "initialize"
    type = "request"

      [debugger.interactive.initializeMessage.arguments]
      adapterID = "debugpy"
      clientID = "replit"
      clientName = "replit.com"
      columnsStartAt1 = true
      linesStartAt1 = true
      locale = "en-us"
      pathFormat = "path"
      supportsInvalidatedEvent = true
      supportsProgressReporting = true
      supportsRunInTerminalRequest = true
      supportsVariablePaging = true
      supportsVariableType = true

    # How to tell the debugger to start the debuggee application.
    [debugger.interactive.launchMessage]
    command = "attach"
    type = "request"

      [debugger.interactive.launchMessage.arguments]
      logging = {}

# Configures the packager.
[packager]
# Search packages in PyPI.
language = "python3"
# Never attempt to install `unit_tests`. If there are packages that are being
# guessed wrongly, add them here.
ignoredPackages = ["unit_tests"]

  [packager.features]
  enabledForHosting = false
  # Enable searching packages from the sidebar.
  packageSearch = true
  # Enable guessing what packages are needed from the code.
  guessImports = true
```

OKï¼Œè·‘èµ·æ¥ä¹‹åï¼Œå°±å®ç°äº†è‡ªåŠ¨åˆ·æ–°ç¼“å­˜ token æ¨é€å¾®ä¿¡çš„åŠŸèƒ½

### Try Post å‘é€è¯·æ±‚è‡³éƒ¨ç½²çš„åœ°å€

```json
POST Method
Body X-WWW-form-urlencoded è¡¨å•
"type": "Note",
"title": "Test title",
"body": "Test body",
"wecom_touid": "@all"
```

åº”è¯¥å¯ä»¥æ”¶åˆ°æ¶ˆæ¯äº†ï¼Œé‚£ä¹ˆè¿™ä¹ˆä¸€ä¸ªæ¨é€ç«¯æˆ‘ä»¬å°±æ­å¥½äº†

åªéœ€è¦å¯¹æ¥ `Uptime` å°± OK äº†ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯æ”¹é€  `pushbullet.js` è¿™ä¸ªæ¨é€æºï¼ˆé‡Œé¢çš„æ¨é€ç½‘å€æ”¹æˆä½ çš„ï¼‰

`.\server\notification-providers\pushbullet.js`

```js
const NotificationProvider = require("./notification-provider");
const axios = require("axios");
var qs = require('qs');

const { DOWN, UP } = require("../../src/util");

class Pushbullet extends NotificationProvider {

    name = "pushbullet";

    async send(notification, msg, monitorJSON = null, heartbeatJSON = null) {
        let okMsg = "Sent Successfully.";
        try {
            let pushbulletUrl = "https://xxxxx.xxxxxxxxxxxxxx.xxxx.xx";
            let config = {
                headers: {
                    "Content-Type": "application/json"
                }
            };
            if (heartbeatJSON == null) {
                let testdata = {
                    "type": "note",
                    "title": "Uptime Kuma Alert",
                    "body": "Testing Successful.",
                    "wecom_touid": notification.pushbulletAccessToken
                }
                // æäº¤ æ„é€ fromè¡¨å•
                var access_token_data = qs.stringify(testdata);
                var _config = {
                  method: 'post',
                  url: pushbulletUrl,
                  headers: { 
                    'Content-Type': 'application/x-www-form-urlencoded'
                  },
                  data : access_token_data
                };
                await axios(_config)
            } else if (heartbeatJSON["status"] == DOWN) {
                let downdata = {
                    "type": "note",
                    "title": "UptimeKuma Alert: " + monitorJSON["name"],
                    "body": "[ğŸ”´ Down] " + heartbeatJSON["msg"] + "\nTime (UTC): " + heartbeatJSON["time"],
                    "wecom_touid": notification.pushbulletAccessToken
                }
                // æäº¤ æ„é€ fromè¡¨å•
                var access_token_data = qs.stringify(downdata);
                var _config = {
                  method: 'post',
                  url: pushbulletUrl,
                  headers: { 
                    'Content-Type': 'application/x-www-form-urlencoded'
                  },
                  data : access_token_data
                };
                await axios(_config)
            } else if (heartbeatJSON["status"] == UP) {
                let updata = {
                    "type": "note",
                    "title": "UptimeKuma Alert: " + monitorJSON["name"],
                    "body": "[âœ… Up] " + heartbeatJSON["msg"] + "\nTime (UTC): " + heartbeatJSON["time"],
                    "wecom_touid": notification.pushbulletAccessToken
                }
                // æäº¤ æ„é€ fromè¡¨å•
                var access_token_data = qs.stringify(updata);
                var _config = {
                  method: 'post',
                  url: pushbulletUrl,
                  headers: { 
                    'Content-Type': 'application/x-www-form-urlencoded'
                  },
                  data : access_token_data
                };
                await axios(_config)
            }
            return okMsg;
        } catch (error) {
            this.throwGeneralAxiosError(error)
        }
    }
}

module.exports = Pushbullet;

```

å› ä¸ºæˆ‘æŠ€æœ¯èœï¼Œæ‰€ä»¥è¿™é‡Œå¤šå¼•å…¥äº†ä¸€ä¸ªåº“ `qs` ï¼Œéœ€è¦å¼•å…¥ä¸€ä¸‹

`package.json`

```json
"dependencies": {
+        "qs": "6.10.3",
},
```

okï¼Œè¿™æ ·éƒ¨ç½²å¥½äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜ç¼ºå°‘ä¸€ä¸ªå‚æ•° 

- `wecom_touid` ï¼šåˆ°åº•è¦å‘ç»™è°å‘¢ï¼Ÿ
- ä½ å¯ä»¥é€‰è¿™ä¸¤ç§æ–¹å¼ ï¼š `@all` æ¨é€ç»™æ‰€æœ‰å…³æ³¨æœåŠ¡çš„äººï¼Œä¹Ÿå¯ä»¥å¡«ç”¨æˆ· `ID`

### ç”¨æˆ·IDåœ¨è¿™é‡Œçœ‹ 

- [Serveré…±Â·Turboç‰ˆ (ftqq.com)](https://sct.ftqq.com/forward)

![5](https://ik.imagekit.io/zkeq/2022-04-24/5.png)

é‡Œé¢çš„ 

![6](https://ik.imagekit.io/zkeq/2022-04-24/6.png)

è¿™ä¸ªå°±æ˜¯ ç”¨æˆ· ID ï¼ŒæˆåŠŸå°†ç›‘æ§é¡¹ç›®è·‘èµ·æ¥ä¹‹å

æ·»åŠ é€šçŸ¥é¡¹ï¼Œé€‰æ‹© `pushbullet` é‡Œé¢çš„ `Access Token` å¡«

- è¦é€šçŸ¥çš„ `ç”¨æˆ· ID` 

- æˆ– `@all`

ç‚¹å‡»æµ‹è¯•ï¼Œèƒ½æ”¶åˆ°æ¶ˆæ¯å³æ­å»ºæˆåŠŸ

------------

### é¡ºä¾¿æä¸€å˜´

##### æ–¹ç³–çš„ `PushDeer` ä¹Ÿå¯¹æ¥æˆåŠŸäº†

è¿˜æ˜¯é‚£ä¸ªæ–‡ä»¶

`.\server\notification-providers\pushbullet.js`

```js
const NotificationProvider = require("./notification-provider");
const axios = require("axios");
var qs = require('qs');

const { DOWN, UP } = require("../../src/util");

class Pushbullet extends NotificationProvider {

    name = "pushbullet";

    async send(notification, msg, monitorJSON = null, heartbeatJSON = null) {
        let okMsg = "Sent Successfully.";

        try {
            let pushbulletUrl = "https://sc.ftqq.com/" + notification.pushbulletAccessToken + ".send";
            let config = {
                headers: {
                    "Content-Type": "application/json"
                }
            };
            if (heartbeatJSON == null) {
                let testdata = {
                    "title": "Uptime Kuma Alert",
                    "desp": "Testing Successful."
                }
                // æäº¤ æ„é€ fromè¡¨å•
                var access_token_data = qs.stringify(testdata);
                var _config = {
                  method: 'post',
                  url: pushbulletUrl,
                  headers: { 
                    'Content-Type': 'application/x-www-form-urlencoded'
                  },
                  data : access_token_data
                };
                await axios(_config)
            } else if (heartbeatJSON["status"] == DOWN) {
                let downdata = {
                    "title": "UptimeKuma Alert: " + monitorJSON["name"],
                    "desp": "[ğŸ”´ Down] " + heartbeatJSON["msg"] + "\nTime (UTC): " + heartbeatJSON["time"],
                }
                // æäº¤ æ„é€ fromè¡¨å•
                var access_token_data = qs.stringify(downdata);
                var _config = {
                  method: 'post',
                  url: pushbulletUrl,
                  headers: { 
                    'Content-Type': 'application/x-www-form-urlencoded'
                  },
                  data : access_token_data
                };
                await axios(_config)
            } else if (heartbeatJSON["status"] == UP) {
                let updata = {
                    "title": "UptimeKuma Alert: " + monitorJSON["name"],
                    "desp": "[âœ… Up] " + heartbeatJSON["msg"] + "\nTime (UTC): " + heartbeatJSON["time"],
                }
                // æäº¤ æ„é€ fromè¡¨å•
                var access_token_data = qs.stringify(updata);
                var _config = {
                  method: 'post',
                  url: pushbulletUrl,
                  headers: { 
                    'Content-Type': 'application/x-www-form-urlencoded'
                  },
                  data : access_token_data
                };
                await axios(_config)
            }
            return okMsg;
        } catch (error) {
            this.throwGeneralAxiosError(error)
        }
    }
}

module.exports = Pushbullet;

```

è¿™ä¸ªé’ˆå¯¹æ–¹ç³–çš„è®¢é˜…ç”¨æˆ·ï¼ˆï¼ˆ

è¿˜æ˜¯é‚£ä¸ª `pushbullet` é€šé“ï¼Œ`Access Token` å¡«æˆä½ çš„å°±è¡Œ

ç±»ä¼¼äº

- `SCT888888XXXXXXXXXXXXXXXXXXXXXXX`

è¿™ç§çš„ï¼Œå¡«ä¸Šæµ‹è¯•ä¸€ä¸‹ï¼Œå¦‚æœæ”¶åˆ°æ¶ˆæ¯å³å¯¹æ¥æˆåŠŸï¼ˆè€è§„çŸ©è¦å…ˆåŠ ä¸Šé‚£ä¸ª `qs` çš„åº“ï¼‰

---------------------

æœ‰é—®é¢˜è¯„è®ºåŒºè”ç³»ï¼ˆ